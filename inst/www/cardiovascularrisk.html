<!DOCTYPE html>
<html lang="en">
<head>
<title>openRules</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- ocpu library -->
<script src="jquery/jquery-2.0.3_min.js"> </script>
<script src="opencpu/opencpu.js"> </script>

<!-- some optional styling stuff -->

<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>

 <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the values
        var age0 = $("#age").val() * 1;
		var gender = 'f'
		if ($("#gender1").prop("checked") == true){gender = 'm'}
		var ethnicity = 'h'
		if ($("#ethnicity0").prop("checked") == true){ethnicity = 'b'}
		if ($("#ethnicity1").prop("checked") == true){ethnicity = 'w'}
		if ($("#ethnicity2").prop("checked") == true){ethnicity = 'a'}
		if ($("#ethnicity3").prop("checked") == true){ethnicity = 'h'}
		var smoke0 = 0
		if ($("#smoker1").prop("checked") == true){smoke0 = 1}
		var diabetes0 = 0
		if ($("#diabetes1").prop("checked") == true){diabetes0 = 1}
		var bprx = 0
		if ($("#bprx1").prop("checked") == true){bprx = 1}
        var sbp = $("#sbp").val() * 1;
        var tchol0 = $("#tchol").val() * 1;
        var hdl0 = $("#hdl").val() * 1;
	  
        //perform the request
        var req = opencpu.r_fun_json("cardiovascularrisk", {
        age0 : age0,
        gender : gender,
        ethnicity : ethnicity,
        smoke0 : smoke0,
		diabetes0 : diabetes0,
		bprx : bprx,
		sbp : sbp,
		tchol0 : tchol0,
		hdl0 : hdl0
	  }, function(output){
          $("#output").text(output.message);
        });
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });

      //this is only needed when using CORS (i.e. web pages hosted outside opencpu)
      if(!location.pathname.match("^/ocpu/.*/appdemo/www")){
        opencpu.seturl("//public.opencpu.org/ocpu/library/appdemo/R");
      }
    });
    </script>
    
    <style>
      #output{
        height: 40px;
        width: 500px;
        border: 1px solid gray;
        padding: 3px;
      }
    </style>
    

</head>

<body>
<!-- 
http://jquery-csv.googlecode.com/git/examples/basic-usage.html
http://jquery-csv.googlecode.com/git/examples/flot.html -> seems best and most stable without reticulating spines error
http://code.google.com/p/jquery-csv/wiki/API -> instructions
-->
<div class="container" style="width:1000px;">

    <div class="page-header" style="color:#0022B4">
		<div style="float:left;color:#0022B4">
			<h1>openRules</h1>
			<h2>Pooled Cohort ASCVD Risk Equations</h2>
		</div>
	<div style="clear:both"></div>
	
        <form id="paramform" target="target" style="width:500px;">
          <fieldset style="border: 3px solid #6DC6E7; background-color: #FFFFFF;width:500px;height:400px;">
		  <legend>Enter values:</legend>

	    <div style="display:block">Age: <input type="text" id="age"></div>
             
		<div style="display:block"><label>Gender:</label><br/>
		<input type="radio" name="gender" id="gender1" value="m"><label for="gender1">Male</label><br/>
		<input type="radio" name="gender" id="gender0" value="f"><label for="gender0">Female</label>
		</div> 
		<div style="display:block"><label>Ethnicity:</label><br/>
		<input type="radio" name="ethnicity" id="ethnicity0" value="b"><label for="ethnicity0">African-American</label>
		<input type="radio" name="ethnicity" id="ethnicity1" value="w"><label for="ethnicity1">Anglo</label><br/>
		<input type="radio" name="ethnicity" id="ethnicity2" value="a"><label for="ethnicity2">Asian</label>
		<input type="radio" name="ethnicity" id="ethnicity3" value="h"><label for="ethnicity3">Hispanic</label>
		</div> 
		<div style="display:block"><label>Smoker (current or former):</label><br/>
		<input type="radio" name="smoker" id="smoker0" value="0"><label for="smoker0">No</label>
		<input type="radio" name="smoker" id="smoker1" value="1"><label for="smoker1">Yes</label><br/>
		</div> 
		<div style="display:block"><label>Diabetes:</label><br/>
		<input type="radio" name="diabetes" id="diabetes0" value="0"><label for="diabetes0">No</label>
		<input type="radio" name="diabetes" id="diabetes1" value="1"><label for="diabetes1">Yes</label><br/>
		</div> 
		<div style="display:block"><label>Medication for hypertension:</label><br/>
		<input type="radio" name="bprx" id="bprx0" value="0"><label for="bprx0">No</label>
		<input type="radio" name="bprx" id="bprx1" value="1"><label for="bprx1">Yes</label><br/>
		</div> 
	    <div style="display:block">Systolic blood pressure: <input type="text" id="sbp"></div>
	    <div style="display:block">Total cholesterol: <input type="text" id="tchol"></div>
	    <div style="display:block">HDL cholesterol: <input type="text" id="hdl"></div>
			
		<button id="submitbutton" type="button">Submit (answer will show below)</button>
 
          </fieldset>
        </form>
		
    <p id="output"></p>
	
    </div>
	  <h3>References</h3>
	  <ol>
	  <li>Goff DC Jr, Lloyd-Jones DM, Bennett G, Coady S, D'Agostino RB Sr, Gibbons R, Greenland P, Lackland DT, Levy D, O'Donnell CJ, Robinson J, Schwartz JS, Shero ST, Smith SC Jr, Sorlie P, Stone NJ, Wilson PW. 2013 ACC/AHA Guideline on the Assessment of Cardiovascular Risk: A Report of the American College of Cardiology/American Heart Association Task Force on Practice Guidelines. Circulation. 2013. PMID: 24222018. <a href="http://pubmed.gov/24222018">24222018</a></li>
	  </ol>
    <div class="row">
      <div class="span12">

	  <h3>About</h3>
	        <ul>
			<li><a href="https://github.com/clinicalpredictionrules">Source code at GitHub</a> (please add new prediction rules or improve existing rules)</li>
			<li><a href="../man/clinicalpredictionrules/html">Help</a></li>
			<li>These pages may not function on older versions of Internet Explorer.</li>
		</ul>
		<div id=""><a href="mailto:rbadgett@kumc.edu">rbadgett@kumc.edu</a></div>
		</div>
		</div>
  </div>
</body>
</html>
