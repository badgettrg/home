<!DOCTYPE html>
<html lang="en">
<head>
<title>openRules</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- ocpu library -->
<script src="jquery/jquery-2.0.3_min.js"> </script>
<script src="opencpu/opencpu.js"> </script>

<!-- some optional styling stuff -->

<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>

 <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the values
        var age = $("#age").val() * 1;
        var diameter = $("#diameter").val() * 1;
		var cancer = 0 
		if ($("#cancer1").prop("checked") == true){cancer = 1}
		var smoker = 0 
		if ($("#smoker1").prop("checked") == true){smoker = 1}
		var location = 0 
		if ($("#location1").prop("checked") == true){location = 1}
		var spiculation = 0
		if ($("#spiculation1").prop("checked") == true){spiculation = 1}
	  
        //perform the request
        var req = opencpu.r_fun_json("pulmnodule", {
        age : age,
        cancer : cancer,
        smoker : smoker,
        diameter : diameter,
        spiculation : spiculation,
        location : location
	  }, function(output){
          $("#output").text(output.message);
        });
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });

      //this is only needed when using CORS (i.e. web pages hosted outside opencpu)
      if(!location.pathname.match("^/ocpu/.*/appdemo/www")){
        opencpu.seturl("//public.opencpu.org/ocpu/library/appdemo/R");
      }
    });
    </script>
    
    <style>
      #output{
        height: 40px;
        width: 500px;
        border: 1px solid gray;
        padding: 3px;
      }
    </style>
    

</head>

<body>
<!-- 
http://jquery-csv.googlecode.com/git/examples/basic-usage.html
http://jquery-csv.googlecode.com/git/examples/flot.html -> seems best and most stable without reticulating spines error
http://code.google.com/p/jquery-csv/wiki/API -> instructions
-->
<div class="container" style="width:1000px;">

    <div class="page-header" style="color:#0022B4">
		<div style="float:left;color:#0022B4">
			<h1>openRules</h1>
			<h2>Pulmonary nodule - risk of malignancy</h2>
			<div>Equations are from references 1 and 2. Guidelines for interpeting results are in reference 3.</div></div>
		</div>
	<div style="clear:both"></div>
	
        <form id="paramform" target="target" style="width:500px;">
          <fieldset style="border: 3px solid #6DC6E7; background-color: #FFFFFF;width:500px;height:400px;">
		  <legend>Enter values:</legend>

	    <div style="display:block">Age: <input type="text" id="age"></div>
	    <div style="display:block">Diameter of nodule (millimeters): <input type="text" id="diameter"></div>
             
		<div style="display:block"><label>Cancer (history of an extrathoracic cancer that was diagnosed > 5 years ago):</label><br/>
		<input type="radio" name="cancer" id="cancer0" value="0"><label for="cancer0">No</label>
		<input type="radio" name="cancer" id="cancer1" value="1"><label for="cancer1">Yes</label><br/>
		</div> 
		<div style="display:block"><label>Smoker (current or former):</label><br/>
		<input type="radio" name="smoker" id="smoker0" value="0"><label for="smoker0">No</label>
		<input type="radio" name="smoker" id="smoker1" value="1"><label for="smoker1">Yes</label><br/>
		</div> 
		<div style="display:block"><label>Spiculation:</label><br/>
		<input type="radio" name="spiculation" id="spiculation0" value="0"><label for="spiculation0">No</label>
		<input type="radio" name="spiculation" id="spiculation1" value="1"><label for="spiculation1">Yes</label><br/>
		</div> 
		<div style="display:block"><label>Location:</label><br/>
		<input type="radio" name="location" id="location1" value="1"><label for="location1">Upper lobe</label><br/>
		<input type="radio" name="location" id="location0" value="0"><label for="location0">Other location</label>
		</div> 
			
		<button id="submitbutton" type="button">Submit (answer will show below)</button>
 
          </fieldset>
        </form>
		
    <p id="output"></p>
	
    </div>
	  <h3>References</h3>
	  <ol>
	  <li>Swensen SJ, Silverstein MD, Ilstrup DM, Schleck CD, Edell ES: The probability of malignancy in solitary pulmonary nodules. Application to small radiologically indeterminate nodules. Arch Intern Med 1997;157(8):849-855. PMID: <a href="http://pubmed.gov/9129544">9129544</a></li>
	  <li>Herder GJ, van Tinteren H, Golding RP, et al: Clinical prediction model to characterize pulmonary nodules: validation and added value of 18F-fluorodeoxyglucose positron emission tomography. Chest 2005;128(4):2490-2496. PMID: <a href="http://pubmed.gov/16236914">16236914</a></li>
	  <li>Gould MK et al. Evaluation of individuals with pulmonary nodules: when is it lung cancer? Diagnosis and management of lung cancer, 3rd ed: American College of Chest Physicians evidence-based clinical practice guidelines. Chest. 2013 May;143(5 Suppl):e93S-120S. doi: <a href="http://dx.doi.org/10.1378/chest.12-2351"></a>10.1378/chest.12-2351</a>. PMID: <a href="http://pubmed.gov/23649456"></a>23649456</a>; <a href="http://pubmedcentral.gov/PMC3749714"></a>PMC3749714</a>.</li>
	  </ol>
    <div class="row">
      <div class="span12">

	  <h3>About</h3>
	        <ul>
			<li><a href="https://github.com/openRules">Source code at GitHub</a> (please add new prediction rules or improve existing rules)</li>
			<li><a href="../man/pulmnodule/html">Help</a></li>
			<li>These pages may not function on some versions of Internet Explorer.</li>
		</ul>
		<div id=""><a href="mailto:rbadgett@kumc.edu">rbadgett@kumc.edu</a></div>
		</div>
		</div>
  </div>
</body>
</html>
