<!DOCTYPE html>
<html lang="en">
<head>
<title>openRules</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- jquery -->
<script src="//code.jquery.com/jquery-2.1.3.min.js"> </script>

<!-- ocpu library -->
<script src="opencpu/opencpu.js"> </script>

<!-- tooltip -->
<script type="text/javascript" src="qtip/jquery.qtip.min.js"></script>
<link rel="stylesheet" type="text/css" href="qtip/jquery.qtip.min.css" />

<!-- some optional styling stuff -->
<script src="bootstrap/js/bootstrap.js"></script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"></script>

<script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the values
        var genetics                   = $("#genetics").val();
        var history                    = $("#history").val();
		var current_age                = $("#current_age").val();
		var age_at_menarche            = $("#age_at_menarche").val();
		var age_at_first_live_birth    = $("#age_at_first_live_birth").val();
		var related_with_breast_cancer = $("#related_with_breast_cancer").val();
		//var ever_had_biopsy            = $("#ever_had_biopsy").val();
		var previous_biopsies          = $("#previous_biopsies").val();
		var biopsy_with_hyperplasia    = $("#biopsy_with_hyperplasia").val();
		var race                       = $("#race").val();
		var subrace                    = $("#subrace").val();

        //perform the request
        var req = opencpu.r_fun_json("bcra", {
        genetics                   : genetics,
		history                    : history,
		T1                         : current_age,
		AgeMen                     : age_at_menarche,
		Age1st                     : age_at_first_live_birth,
		N_Rels                     : related_with_breast_cancer,
		//ever_had_biopsy            : ever_had_biopsy,
		N_Biop                     : previous_biopsies,
		HypPlas                    : biopsy_with_hyperplasia,
		Race                       : race,
		subrace                    : subrace,

		}, function(output){
          document.getElementById("output").innerHTML = output.message
        });
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });

	//http://qtip2.com/
	// Apply tooltip on all <a/> elements with title attributes. Mousing over
    // these elements will the show tooltip as expected, but mousing onto the
    // tooltip is now possible for interaction with it's contents.
    //$('a').each(function () {
    $('.hastip').each(function () {
        $(this).qtip({
            content: $(this).next('.tooltiptext'),
            hide: {
                fixed: true,
                delay: 300
            },
			position: {
				my: 'bottom left',  // Position my top left...
				at: 'bottom right', // at the bottom right of...
			},
			style: { classes: 'ToolTipClass'
			}
		});
    });

	$('.hastip').click(function(e) {
		e.stopPropagation();
		return false;
	});	
      //this is only needed when using CORS (i.e. web pages hosted outside opencpu)
      if(!location.pathname.match("^/ocpu/.*/appdemo/www")){
        opencpu.seturl("//public.opencpu.org/ocpu/library/appdemo/R");
      }
    });
    </script>
    
    <style>
      #output{
       /*  height: 40px;
        width: 400px;
        border: 1px solid gray;
        padding: 3px; */
      }

	  .tooltiptext{
			display: none;
		}
	  .ToolTipClass{
		color:black;
		border-color:#0022B4;
		background-color: #6DC6E7
		}
    </style>

</head>

<body>
<!-- 
http://jquery-csv.googlecode.com/git/examples/basic-usage.html
http://jquery-csv.googlecode.com/git/examples/flot.html -> seems best and most stable without reticulating spines error
http://code.google.com/p/jquery-csv/wiki/API -> instructions
-->
<div class="container" style="width:1000px;">

    <div class="page-header" style="color:#0022B4">
			<h1>openRules</h1>
			<h2>What is my chance of breast cancer after 10 years, 20 years, or lifetime?</h2>
			<div id="">This page uses the NASBP2 calculator for breast cancer risk accessment</div>

			<div style="float:left;color:#0022B4">
	
        <form id="paramform" target="target" style="width:400px;">
          <fieldset style="border: 3px solid #6DC6E7; background-color: #FFFFFF;width:400px;height:450px;">
		  <legend>Enter values:</legend>

            <table width="466" cellspacing="0" cellpadding="0" border="0">
                <tr>
                    <td valign="top" width="19">
                        <a href="about-tool.aspx#q1">1</a>.
                    </td>
                    <td valign="top" width="330" colspan="2">
                        <label for="history">
                            Does the woman have a medical history of any breast cancer or of
                        </label>
                        <a class="grey-text" href="def-dcis.html" onclick="popUp('def-dcis.html');return false;">
                            ductal carcinoma in situ (DCIS)</a> or <a class="grey-text" href="def-lcis.html"
                                onclick="popUp('def-lcis.html');return false;">lobular carcinoma in situ (LCIS)</a>
                        or has she received previous radiation therapy to the chest for treatment of Hodgkin
                        lymphoma?
                    </td>
                    <td valign="top" width="8">
                        &nbsp;
                    </td>
                    <td valign="top" width="109" align="right">
                        <select id="history" name="history" onchange="checkHistory()">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top" width="19">
                        <a href="about-tool.aspx#q2">2</a>.
                    </td>
                    <td valign="top" width="330" colspan="2">
                        <label for="genetics">
                            Does the woman have a mutation in either the <a class="grey-text" href="def-brca1.html" onclick="popUp('def-brca1.html');return false;"><em>BRCA1</em></a> or <a class="grey-text" href="def-brca2.html" onclick="popUp('def-brca2.html');return false;"><em>BRCA2</em></a> gene,
                        or a diagnosis of a genetic syndrome that may be associated with elevated risk of
                        breast cancer?
                        </label>
                    </td>
                    <td valign="top" width="8">
                        &nbsp;
                    </td>
                    <td valign="top" width="109" align="right">
                        <select id="genetics" name="genetics" onchange="checkGenetics()">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                            <option value="2">Unknown</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <a href="about-tool.aspx#q3">3</a>.
                    </td>
                    <td valign="top" colspan="2">
                        <label for="current_age">
                            What is the woman's age?</label><br />
                        <em>This tool only calculates risk for women 35 years of age or older.</em>
                    </td>
                    <td valign="top">
                        &nbsp;
                    </td>
                    <td valign="top" align="right">
                        <select id="current_age" name="current_age" size="1" onchange="checkAge()">
                            <option value="99">Select</option>
                            <option value="34">&lt; 35</option>
                            <option value="35">35</option>
                            <option value="36">36</option>
                            <option value="37">37</option>
                            <option value="38">38</option>
                            <option value="39">39</option>
                            <option value="40">40</option>
                            <option value="41">41</option>
                            <option value="42">42</option>
                            <option value="43">43</option>
                            <option value="44">44</option>
                            <option value="45">45</option>
                            <option value="46">46</option>
                            <option value="47">47</option>
                            <option value="48">48</option>
                            <option value="49">49</option>
                            <option value="50">50</option>
                            <option value="51">51</option>
                            <option value="52">52</option>
                            <option value="53">53</option>
                            <option value="54">54</option>
                            <option value="55">55</option>
                            <option value="56">56</option>
                            <option value="57">57</option>
                            <option value="58">58</option>
                            <option value="59">59</option>
                            <option value="60">60</option>
                            <option value="61">61</option>
                            <option value="62">62</option>
                            <option value="63">63</option>
                            <option value="64">64</option>
                            <option value="65">65</option>
                            <option value="66">66</option>
                            <option value="67">67</option>
                            <option value="68">68</option>
                            <option value="69">69</option>
                            <option value="70">70</option>
                            <option value="71">71</option>
                            <option value="72">72</option>
                            <option value="73">73</option>
                            <option value="74">74</option>
                            <option value="75">75</option>
                            <option value="76">76</option>
                            <option value="77">77</option>
                            <option value="78">78</option>
                            <option value="79">79</option>
                            <option value="80">80</option>
                            <option value="81">81</option>
                            <option value="82">82</option>
                            <option value="83">83</option>
                            <option value="84">84</option>
                            <option value="85">85</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <a href="about-tool.aspx#q4">4</a>.
                    </td>
                    <td valign="top" colspan="2">
                        <label for="age_at_menarche">
                            What was the woman's age at the time of her first</label>
                        <a class="grey-text" href="def-menst.html" onclick="popUp('def-menst.html');return false;">
                            menstrual period</a>?
                    </td>
                    <td valign="top">
                        &nbsp;
                    </td>
                    <td valign="top" align="right">
                        <select id="age_at_menarche" name="age_at_menarche" size="1">
                            <option value="999">Select</option>
                            <option value="99">Unknown</option>
                            <option value="10">7 to 11</option>
                            <option value="13">12 to 13</option>
                            <option value="14">&gt; =14</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <a href="about-tool.aspx#q5">5</a>.
                    </td>
                    <td valign="top" colspan="2">
                        <label for="age_at_first_live_birth">
                            What was the woman's age at the time of her first live birth of a child?</label>
                    </td>
                    <td valign="top">
                        &nbsp;
                    </td>
                    <td valign="top" align="right">
                        <select id="age_at_first_live_birth" name="age_at_first_live_birth" size="1">
                            <option value="999">Select</option>
                            <option value="99">Unknown</option>
                            <option value="0">No births</option>
                            <option value="15">&lt; 20</option>
                            <option value="22">20 to 24</option>
                            <option value="27">25 to 29</option>
                            <option value="30">&gt; =30</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <a href="about-tool.aspx#q6">6</a>.
                    </td>
                    <td valign="top" colspan="2">
                        <label for="related_with_breast_cancer">
                            How many of the woman's first-degree relatives - mother, sisters, daughters - have
                            had breast cancer?</label>
                    </td>
                    <td valign="top">
                        &nbsp;
                    </td>
                    <td valign="top" align="right">
                        <select id="related_with_breast_cancer" name="related_with_breast_cancer" size="1">
                            <option value="999">Select</option>
                            <option value="99">Unknown</option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">&gt; 1</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <a href="about-tool.aspx#q7a">7a</a>.
                    </td>
                    <td valign="top" colspan="2">
                        <label for="previous_biopsies">
                            How many breast biopsies (positive or negative) has the woman had?</label>
                    </td>
                    <td valign="top" width="8">
                        &nbsp;
                    </td>
                    <td valign="top" width="109" align="right">
                        <select id="previous_biopsies" name="previous_biopsies" size="1">
                            <option value="999">Select</option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">&gt; 1</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" colspan="5">
                        <img src="images/spacer.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <a href="about-tool.aspx#q7b">7b</a>.
                    </td>
                    <td valign="top" colspan="2">
                        <label for="biopsy_with_hyperplasia">
                            Has the woman had at least one breast biopsy with</label>
                        <a class="grey-text" href="def-ah.html" onclick="popUp('def-ah.html');return false;">
                            atypical hyperplasia</a>?
                    </td>
                    <td valign="top">
                        &nbsp;
                    </td>
                    <td valign="top" align="right">
                        <select id="biopsy_with_hyperplasia" name="biopsy_with_hyperplasia" size="1">
                            <option value="999">Select</option>
                            <option value="99">Unknown</option>
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" background="images/questions-divider.gif" colspan="5">
                        <img src="images/questions-divider.gif" width="4" height="20" alt="" />
                    </td>
                </tr>
                <tr>
                    <td colspan="5">
                        <table cellpadding="0" cellspacing="0" width="466">
                            <tr>
                                <td valign="top" width="19">
                                    <a href="about-tool.aspx#q8">8</a>.
                                </td>
                                <td valign="top" width="229" colspan="2">
                                    <label for="race">
                                        What is the woman's race/ethnicity?</label>
                                </td>
                                <td valign="top" width="8">
                                    &nbsp;
                                </td>
                                <td valign="top" align="right" width="210">
                                    <select id="race" name="race" size="1" onchange="checkEthnicity()" style="width: 210px;">
                                        <option value="999">Select</option>
                                        <option value="1">White</option>
                                        <option value="2">African American</option>
                                        <option value="3">Hispanic</option>
                                        <option value="4">Asian-American</option>
                                        <option value="5">American Indian or Alaskan Native</option>
										<!-- Careful, at NCI website: 5=Wo White 1995-03 SEER rates (rates under further investigation)-->
                                        <option value="6">Chinese-American</option>
                                        <option value="7">Japanese-American</option>
                                        <option value="8">Filipino-American</option>
                                        <option value="9">Hawaiian-American</option>
                                        <option value="10">Other Pacific Islander</option>
                                        <option value="11">Other Asian</option>
                                        <option value="12">Other Asian-American</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td valign="top" colspan="5">
                                    <img src="images/spacer.gif" width="4" height="20" alt="" />
                                </td>
                            </tr>
                            <tr>
                                <td valign="top" colspan="5">
                                    <img src="images/spacer.gif" width="4" height="20" alt="" />
                                </td>
                            </tr>
                        </table>

		<button id="submitbutton" type="button">Submit (answer will show to the right)</button>
          </fieldset>
        </form>
	</div>
     <div id="output" style="width:550px;float:right">
	 </div>
	<div style="clear:both"></div>
    </div>

	<h3>References</h3>
	  <ol>
	  <li>Costantino JP, Gail MH, Pee D, Anderson S, Redmond CK, Benichou J, Wieand S,  Validation studies for models projecting the risk of invasive and total breast cancer incidence. J Natl Cancer Inst 1999; 91:1541-1548 PMID: <a href="http://pubmed.gov/10491430">10491430</a>.</li>
	  </ol>
    <div class="row">
      <div class="span12">

	  	  <h3>About</h3>
	        <ul>
			<li><a href="https://github.com/openRules">Source code at GitHub</a></li>
			<li><a href="../man/cardiovascularrisk/html">Manual</a></li>
			<li>Contribute: <a href="https://github.com/openRules/home/issues?q=team%3AopenRules%2FCardiovascular-risk ">open issues</a></li>
			<li><a href="https://github.com/orgs/openRules/teams/cardiovascular-risk">Authors</a></li>
			<li>These pages may not function on some versions of Internet Explorer.</li>
		</ul>
		
		</div>
		</div>
  </div>
</body>
</html>
